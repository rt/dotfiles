::: {.NAVHEADER}
Bash Guide for Beginners
:::

[Prev](sect_09_02.md)

Chapter 9. Repetitive tasks

[Next](sect_09_04.md)

------------------------------------------------------------------------

::: {.sect1}
[]{#sect_09_03}9.3. The until loop {#the-until-loop .sect1}
==================================

::: {.sect2}
[]{#sect_09_03_01}9.3.1. What is it? {#what-is-it .sect2}
------------------------------------

The **until** loop is very similar to the **while** loop, except that
the loop executes until the **TEST-COMMAND** executes successfully. As
long as this command fails, the loop continues. The syntax is the same
as for the **while** loop:

**until TEST-COMMAND; do CONSEQUENT-COMMANDS; done**

The return status is the exit status of the last command executed in the
**CONSEQUENT-COMMANDS** list, or zero if none was executed.
**TEST-COMMAND** can, again, be any command that can exit with a success
or failure status, and **CONSEQUENT-COMMANDS** can be any UNIX command,
script or shell construct.

As we already explained previously, the [\";\"]{.QUOTE} may be replaced
with one or more newlines wherever it appears.
:::

::: {.sect2}
[]{#sect_09_03_02}9.3.2. Example {#example .sect2}
--------------------------------

An improved `picturesort.sh`{.filename} script (see [Section
9.2.2.2](sect_09_02.md#sect_09_02_02_02)), which tests for available
disk space. If not enough disk space is available, remove pictures from
the previous months:

+-----------------------------------------------------------------------+
| ``` {.screen}                                                         |
| #!/bin/bash                                                          |
|                                                                       |
| # This script copies files from my homedirectory into the webserver d |
| irectory.                                                             |
| # A new directory is created every hour.                              |
| # If the pics are taking up too much space, the oldest are removed.   |
|                                                                       |
| while true; do                                                        |
|     DISKFUL=$(df -h $WEBDIR | grep -v File | awk '{print $5 }' | cut  |
| -d "%" -f1 -)                                                         |
|                                                                       |
|     until [ $DISKFUL -ge "90" ]; do                                   |
|                                                                       |
|             DATE=`date +%Y%m%d`                                       |
|             HOUR=`date +%H`                                           |
|             mkdir $WEBDIR/"$DATE"                                     |
|                                                                       |
|                                                                       |
|             while [ $HOUR -ne "00" ]; do                              |
|                     DESTDIR=$WEBDIR/"$DATE"/"$HOUR"                   |
|                     mkdir "$DESTDIR"                                  |
|                     mv $PICDIR/*.jpg "$DESTDIR"/                      |
|                     sleep 3600                                        |
|                     HOUR=`date +%H`                                   |
|             done                                                      |
|                                                                       |
|     DISKFULL=$(df -h $WEBDIR | grep -v File | awk '{ print $5 }' | cu |
| t -d "%" -f1 -)                                                       |
|     done                                                              |
|                                                                       |
|     TOREMOVE=$(find $WEBDIR -type d -a -mtime +30)                    |
|     for i in $TOREMOVE; do                                            |
|         rm -rf "$i";                                                  |
|     done                                                              |
|                                                                       |
| done                                                                  |
| ```                                                                   |
+-----------------------------------------------------------------------+

Note the initialization of the `HOUR`{.varname} and `DISKFULL`{.varname}
variables and the use of options with **ls** and **date** in order to
obtain a correct listing for `TOREMOVE`{.varname}.
:::
:::

::: {.NAVFOOTER}

------------------------------------------------------------------------

  ------------------------- -------------------- ---------------------------
  [Prev](sect_09_02.md)    [Home](index.md)      [Next](sect_09_04.md)
  The while loop             [Up](chap_09.md)    I/O redirection and loops
  ------------------------- -------------------- ---------------------------
:::
